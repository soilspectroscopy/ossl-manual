# Database

```{r, results="asis", echo=FALSE}
status("drafting")
```

**Importing new datasets into OSSL**

The github repository [ossl-imports](https://github.com/soilspectroscopy/ossl-imports) has all the importing codes for preparing and integrating new datasets into the OSSL. The folder [ossl-imports/dataset](https://github.com/soilspectroscopy/ossl-imports/tree/main/dataset) contains all the datasets separated by its name/code, with an internal `README` file describing in detail the steps necessary for preparing and standardizing the files into the OSSL format.

The original files are placed on an internal server to avoid the storage of big files in the github repository, but some of them can be found on persistent online repositories if they have a public license. Other original datasets that do not have a public license or are shared to this project with some restrictions will no be shared publicly. As we keep the original files in a local repository to run the importing notebooks (each `ossl-imports/dataset/../README.Rmd`), this operation can only be run at our internal server. New contributors are encouraged to host their files on a public repository and draft the importing step on github through pull requests. The final checks and consolidation, however, will be concluded on an internal server.

The `README` files follow a basic structure. Each one has a description of the dataset at the top of the notebook which links to the dataset source and references. An extended description is provided in the [OSSL-manual](https://soilspectroscopy.github.io/ossl-manual/soil-spectroscopy-tools-and-users.html#registered-soil-spectral-libraries) as well.

For preparing the import, the following subsections are defined:

- Basic description.
- Soil site information.
- Soil laboratory (wet chemistry) information.
- Mid-infrared (MIR) spectroscopy data (optional).
- Visible-near-infrared (VisNIR) spectroscopy data (optional).
- Quality control.
- References.

Each subsection has its own reading and processing functions, and the outputs can be joined using shared id columns. The output files share the same name and pattern but can be retrieved with different folder names, which are binded together in a final stage. The outputs are `ossl_soilsite_<version>.qs`, `ossl_soillab_<version>.qs`, `ossl_mir_<version>.qs`, `ossl_visnir_<version>.qs`. The version is adjusted in the recurring updates.

**Soil analytical methods**

The contrasting methods used for analytically determining (wet chemistry) a given soil property has also been a subject of internal discussion in this project. Some global initiatives have been facing this same issue in their soil databases but there still no clear or full consensus on how to harmonize those different methods. This has been a topic of great discussion and research development at the [Global Soil Partnership’s Global Soil Laboratory Network (GLOSOLAN)](https://www.fao.org/global-soil-partnership/glosolan/en/).

In order to maximize transparency, for now, we have decided to produce two different levels for the OSSL database. `Level 0` takes into account the original methods employed in each dataset but tries to initially fit them to two reference lists: [KSSL Guidance – Laboratory Methods and Manuals](https://www.nrcs.usda.gov/resources/guides-and-instructions/kssl-guidance) and ISO standards. A copy of the KSSL procedures and coding scheme is archived in [ossl-imports](https://github.com/soilspectroscopy/ossl-imports/blob/main/out/kssl_procedures.csv).

If a reference method does not fall in any previous method, then we create a new variable sharing at least a common property and unit. A final harmonization takes place in the OSSL `Level 1`, where those common properties sharing different methods are converted to a target method using some publicly available transformation rule, or in the worst scenario, they are naively binded or kept separated to produce its specific model. All the implementations are documented in the [ossl-import](https://github.com/soilspectroscopy/ossl-imports/blob/main/out/ossl_level0_to_level1_soillab_harmonization.csv) repository.

**Middle-infrared (MIR) spectra** is provided in absorbance units per wavenumber, with values usually ranging between 0 and 3. The spectral range imported into the OSSL falls between 600 and 4000 cm<sup>-1</sup>, with an interval of 2 cm<sup>-1</sup>. All datasets are harmonized to this specification.

**Visible and Near-Infrared (VisNIR) spectra** is provided in reflectance units per wavelength, with values usually ranging between 0 and 1 as fraction percent. The spectral range imported into the OSSL falls between 350 and 2500 nm, with an interval of 2 nm. All datasets are harmonized to this specification.

**Spectral conversion**

One can convert reflectance (R) values to absorbance units (A) as `A = log10(1/R)`, or backtransform with `R = 1/(10^A)`. Similarly, wavenumber (WN, in cm<sup>-1</sup>) can be converted to wavelength (WL, in nm) with `WN = 1/(WL*10000000)`, or backtransform with `WL = 1/(WL*10000000)`. The factor 10M is used to convert cm to nm.

The following subsections provide the OSSL variable names, types, description, and example. You can also find all this information in tabular format:

- [OSSL soil site data](./tabular/ossl_level0_names_soilsite.csv).
- [OSSL soil lab data (level 0)](./tabular/ossl_level0_names_soillab.csv).
- [OSSL soil lab data (level 1)](./tabular/ossl_level1_names_soillab.csv).
- [OSSL soil MIR data](./tabular/ossl_level0_names_mir.csv).
- [OSSL soil VisNIR data](./tabular/ossl_level0_names_visnir.csv).

```{r config, echo=FALSE}
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r load_data, include=FALSE, eval=FALSE}
library("tidyverse")
library("readr")
library("qs")
library("curl")
library("captioner")
library("openair")

fig_nums <- captioner(prefix = "Fig.")
source("R/ossl_functions.R")

ossl.soilsite <- "https://storage.googleapis.com/soilspec4gg-public/ossl_soilsite_L0_v1.2.qs"
ossl.soilsite <- curl_fetch_memory(ossl.soilsite)
ossl.soilsite <- qdeserialize(ossl.soilsite$content) %>% as_tibble()

ossl.soillab.level0 <- "https://storage.googleapis.com/soilspec4gg-public/ossl_soillab_L0_v1.2.qs"
ossl.soillab.level0 <- curl_fetch_memory(ossl.soillab.level0)
ossl.soillab.level0 <- qdeserialize(ossl.soillab.level0$content) %>% as_tibble()

ossl.soillab.level1 <- "https://storage.googleapis.com/soilspec4gg-public/ossl_soillab_L1_v1.2.qs"
ossl.soillab.level1 <- curl_fetch_memory(ossl.soillab.level1)
ossl.soillab.level1 <- qdeserialize(ossl.soillab.level1$content) %>% as_tibble()
```

<!-- ```{r density_plots, include=FALSE, eval=FALSE} -->
<!-- library("ggplot2") -->
<!-- library("viridis") -->
<!-- library("ggridges") -->
<!-- library("rlang") -->
<!-- library("moments") -->

<!-- names.remove <- c("dataset.code_ascii_txt", "id.layer_uuid_txt", "efferv_usda.a479_class") -->

<!-- ossl.soillab.level0.names <- ossl.soillab.level0 %>% -->
<!--   select(-all_of(names.remove)) %>% -->
<!--   names() -->

<!-- for(i in 1:length(ossl.soillab.level0.names)) { -->

<!--   isoil.property <- ossl.soillab.level0.names[i] -->

<!--   out.png = paste0("./hist_v1.2/hist_L0_", isoil.property, ".png") -->

<!--   plot.df = ossl.soillab.level0 %>% -->
<!--     select(dataset.code_ascii_txt, all_of(isoil.property)) -->

<!--   iskewness <- plot.df %>% -->
<!--     pull(all_of(isoil.property)) %>% -->
<!--     skewness(na.rm = T) -->

<!--   i99th <- plot.df %>% -->
<!--     summarise(!!isoil.property := quantile(!!as.name(isoil.property), p = 0.99, na.rm = T)) %>% -->
<!--     pull(all_of(isoil.property)) -->

<!--   if(iskewness <= -3 | iskewness >= 3) { -->

<!--     plot.df <- plot.df %>% -->
<!--       mutate(!!isoil.property := ifelse(!!as.name(isoil.property) < 0.001, 4096, !!as.name(isoil.property))) %>% -->
<!--       filter(!!as.symbol(isoil.property) < i99th) %>% -->
<!--       mutate(!!isoil.property := log2(!!as.name(isoil.property))) %>% -->
<!--       mutate(!!isoil.property := ifelse(!!as.name(isoil.property) == 12, 0, !!as.name(isoil.property))) -->

<!--     n.table <- plot.df %>% -->
<!--       filter(!is.na(!!as.symbol(isoil.property))) %>% -->
<!--       count(dataset.code_ascii_txt) %>% -->
<!--       mutate(!!isoil.property := {plot.df %>% -->
<!--           summarise(!!isoil.property := max(!!as.name(isoil.property), na.rm = T)) %>% -->
<!--           pull(all_of(isoil.property))*1.1}) -->

<!--     plot <- ggplot(plot.df, aes(x = !!sym(isoil.property), y = dataset.code_ascii_txt, fill = ..x..)) + -->
<!--       geom_density_ridges_gradient(scale = 1, rel_min_height = 0.01, gradient_lwd = 1.) + -->
<!--       scale_x_continuous(expand = c(0.01, 0)) + -->
<!--       scale_y_discrete(expand = c(0.01, 0)) + -->
<!--       scale_fill_viridis(option = "C") + -->
<!--       geom_text(data = n.table, aes(label = paste0("n=", n)), vjust = -0.5, hjust = "inward") + -->
<!--       labs(title = paste0("log2(", isoil.property, ")"), fill = "", x = "", y = "") + -->
<!--       theme_ridges(grid = TRUE, font_size = 13) + -->
<!--       theme(panel.background = element_rect(fill = 'white'), -->
<!--             plot.background = element_rect(fill = 'white')) -->

<!--   } else { -->

<!--     plot.df <- plot.df %>% -->
<!--       filter(!!as.symbol(isoil.property) < i99th) -->

<!--     n.table <- plot.df %>% -->
<!--       filter(!is.na(!!as.symbol(isoil.property))) %>% -->
<!--       count(dataset.code_ascii_txt) %>% -->
<!--       mutate(!!isoil.property := {plot.df %>% -->
<!--           summarise(!!isoil.property := max(!!as.name(isoil.property), na.rm = T)) %>% -->
<!--           pull(all_of(isoil.property))*1.2}) -->

<!--     plot <- ggplot(plot.df, aes(x = !!sym(isoil.property), y = dataset.code_ascii_txt, fill = ..x..)) + -->
<!--       geom_density_ridges_gradient(scale = 1, rel_min_height = 0.01, gradient_lwd = 1.) + -->
<!--       scale_x_continuous(expand = c(0.01, 0)) + -->
<!--       scale_y_discrete(expand = c(0.01, 0)) + -->
<!--       scale_fill_viridis(option = "C") + -->
<!--       geom_text(data = n.table, aes(label = paste0("n=", n)), vjust = -0.5, hjust = "inward") + -->
<!--       labs(title = isoil.property, fill = "", x = "", y = "") + -->
<!--       theme_ridges(grid = TRUE, font_size = 13) + -->
<!--       theme(panel.background = element_rect(fill = 'white'), -->
<!--             plot.background = element_rect(fill = 'white')) -->

<!--   } -->

<!--   ggsave(out.png, plot, width = 7, height = 7, units = "in", scale = 1) -->

<!-- } -->
<!-- ``` -->

```{r heatmap_plots, include=FALSE, eval=FALSE}
library("ggplot2")
library("viridis")
library("rlang")
library("moments")

names.remove <- c("dataset.code_ascii_txt", "id.layer_uuid_txt", "efferv_usda.a479_class")

ossl.soillab.level0.names <- ossl.soillab.level0 %>%
  select(-all_of(names.remove)) %>%
  names()

dataset.codes <- ossl.soillab.level0 %>%
  distinct(dataset.code_ascii_txt)

table.reference <- dataset.codes %>%
  crossing(label = 1:length(seq(0, 1, by = 0.05)))

# test1 <- c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
# cut(test1, breaks = c(0,2,4,6,8,10), include.lowest = F, labels = F, right = F)

for(i in 1:length(ossl.soillab.level0.names)) {
  
  isoil.property <- ossl.soillab.level0.names[i]
  
  out.png = paste0("./heatmap_v1.2/heatmap_L0_", isoil.property, ".png")
  
  plot.df = ossl.soillab.level0 %>%
    select(dataset.code_ascii_txt, all_of(isoil.property))
  
  iskewness <- plot.df %>%
    pull(all_of(isoil.property)) %>%
    skewness(na.rm = T)
  
  i99th <- plot.df %>%
    summarise(!!isoil.property := quantile(!!as.name(isoil.property), p = 0.99, na.rm = T)) %>%
    pull(all_of(isoil.property))
  
  if(iskewness <= -3 | iskewness >= 3) {
    
    plot.df <- plot.df %>%
      mutate(!!isoil.property := ifelse(!!as.name(isoil.property) <= 0.001, NA, !!as.name(isoil.property))) %>%
      filter(!!as.symbol(isoil.property) <= i99th) %>%
      mutate(!!isoil.property := log2(!!as.name(isoil.property)))
    
    percentiles <- plot.df %>%
      summarise(quantile = scales::percent(seq(0, 1, by = 0.05)),
                !!isoil.property := quantile(!!as.name(isoil.property), seq(0, 1, by = 0.05),
                                             names = F, type = 7)) %>%
      group_by(!!as.name(isoil.property)) %>%
      summarise_all(last) %>%
      relocate(quantile, 1) %>%
      mutate(upper = get(isoil.property)) %>%
      mutate(lower = lag(upper, 1)) %>%
      mutate(upper = round(upper, 2), lower = round(lower, 2)) %>%
      mutate(label = paste0("[", lower, ", ", upper, ")"))
    
    n.table <- plot.df %>%
      filter(!is.na(!!as.symbol(isoil.property))) %>%
      group_by(dataset.code_ascii_txt) %>%
      summarise(label = cut(!!as.name(isoil.property),
                            breaks = pull(percentiles, var = 2),
                            include.lowest = F, labels = F, right = F),
                .groups = 'drop') %>%
      count(dataset.code_ascii_txt, label)
      
    table.reference.filled <- left_join(table.reference, n.table,
                                        by = c("dataset.code_ascii_txt", "label")) %>%
      mutate(dataset.code_ascii_txt = factor(dataset.code_ascii_txt,
                                             levels = rev(pull(dataset.codes, 1)))) %>%
      filter(!(label == 21))
    
    plot <- ggplot(table.reference.filled, aes(x = label, y = dataset.code_ascii_txt, fill = n)) +
      geom_tile(color = "gray20") +
      scale_fill_viridis(discrete = FALSE, na.value = "grey90", trans = "log10") +
      scale_x_continuous(breaks = (1:nrow(percentiles))[-nrow(percentiles)],
                         labels = pull(percentiles, 5)[-1],
                         expand = c(0.01, 0)) +
      labs(title = paste0('OSSL level 0: log2(', isoil.property, ')'),
           x = "", y = "", fill = "Count:") +
      theme_minimal() +
      theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
            legend.position = "bottom",
            plot.background = element_rect(fill = 'white', colour = "white"),
            legend.text = element_text(hjust = 1, vjust = 1, angle = 45)); plot
    
  } else {
    
    plot.df <- plot.df %>%
      mutate(!!isoil.property := ifelse(!!as.name(isoil.property) <= 0.001, NA, !!as.name(isoil.property))) %>%
      filter(!!as.symbol(isoil.property) <= i99th)
    
    percentiles <- plot.df %>%
      summarise(quantile = scales::percent(seq(0, 1, by = 0.05)),
                !!isoil.property := quantile(!!as.name(isoil.property), seq(0, 1, by = 0.05),
                                             names = F, type = 7)) %>%
      group_by(!!as.name(isoil.property)) %>%
      summarise_all(last) %>%
      relocate(quantile, 1) %>%
      mutate(upper = get(isoil.property)) %>%
      mutate(lower = lag(upper, 1)) %>%
      mutate(upper = round(upper, 2), lower = round(lower, 2)) %>%
      mutate(label = paste0("[", lower, ", ", upper, ")"))
    
    n.table <- plot.df %>%
      filter(!is.na(!!as.symbol(isoil.property))) %>%
      group_by(dataset.code_ascii_txt) %>%
      summarise(label = cut(!!as.name(isoil.property),
                            breaks = pull(percentiles, var = 2),
                            include.lowest = F, labels = F, right = F),
                .groups = 'drop') %>%
      count(dataset.code_ascii_txt, label)
      
    table.reference.filled <- left_join(table.reference, n.table,
                                        by = c("dataset.code_ascii_txt", "label")) %>%
      mutate(dataset.code_ascii_txt = factor(dataset.code_ascii_txt,
                                             levels = rev(pull(dataset.codes, 1)))) %>%
      filter(!(label == 21))
    
    plot <- ggplot(table.reference.filled, aes(x = label, y = dataset.code_ascii_txt, fill = n)) +
      geom_tile(color = "gray20") +
      scale_fill_viridis(discrete = FALSE, na.value = "grey90", trans = "log10") +
      scale_x_continuous(breaks = (1:nrow(percentiles))[-nrow(percentiles)],
                         labels = pull(percentiles, 5)[-1],
                         expand = c(0.01, 0)) +
      labs(title = paste0('OSSL level 0: ', isoil.property),
           x = "", y = "", fill = "Count:") +
      theme_minimal() +
      theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
            legend.position = "bottom",
            plot.background = element_rect(fill = 'white', colour = "white"),
            legend.text = element_text(hjust = 1, vjust = 1, angle = 45)); plot
    
  }
  
  ggsave(out.png, plot, width = 7, height = 5, units = "in", scale = 1)
  
}
```

```{r heatmap_plots_level1, include=FALSE, eval=FALSE}
library("ggplot2")
library("viridis")
library("rlang")
library("moments")

names.remove <- c("dataset.code_ascii_txt", "id.layer_uuid_txt", "efferv_usda.a479_class")

ossl.soillab.level1.names <- ossl.soillab.level1 %>%
  select(-all_of(names.remove)) %>%
  names()

dataset.codes <- ossl.soillab.level1 %>%
  distinct(dataset.code_ascii_txt)

table.reference <- dataset.codes %>%
  crossing(label = 1:length(seq(0, 1, by = 0.05)))

# test1 <- c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
# cut(test1, breaks = c(0,2,4,6,8,10), include.lowest = F, labels = F, right = F)

for(i in 1:length(ossl.soillab.level1.names)) {
  
  isoil.property <- ossl.soillab.level1.names[i]
  
  out.png = paste0("./heatmap_v1.2/heatmap_L1_", isoil.property, ".png")
  
  plot.df = ossl.soillab.level1 %>%
    select(dataset.code_ascii_txt, all_of(isoil.property))
  
  iskewness <- plot.df %>%
    pull(all_of(isoil.property)) %>%
    skewness(na.rm = T)
  
  i99th <- plot.df %>%
    summarise(!!isoil.property := quantile(!!as.name(isoil.property), p = 0.99, na.rm = T)) %>%
    pull(all_of(isoil.property))
  
  if(iskewness <= -3 | iskewness >= 3) {
    
    plot.df <- plot.df %>%
      mutate(!!isoil.property := ifelse(!!as.name(isoil.property) <= 0.001, NA, !!as.name(isoil.property))) %>%
      filter(!!as.symbol(isoil.property) <= i99th) %>%
      mutate(!!isoil.property := log2(!!as.name(isoil.property)))
    
    percentiles <- plot.df %>%
      summarise(quantile = scales::percent(seq(0, 1, by = 0.05)),
                !!isoil.property := quantile(!!as.name(isoil.property), seq(0, 1, by = 0.05),
                                             names = F, type = 7)) %>%
      group_by(!!as.name(isoil.property)) %>%
      summarise_all(last) %>%
      relocate(quantile, 1) %>%
      mutate(upper = get(isoil.property)) %>%
      mutate(lower = lag(upper, 1)) %>%
      mutate(upper = round(upper, 2), lower = round(lower, 2)) %>%
      mutate(label = paste0("[", lower, ", ", upper, ")"))
    
    n.table <- plot.df %>%
      filter(!is.na(!!as.symbol(isoil.property))) %>%
      group_by(dataset.code_ascii_txt) %>%
      summarise(label = cut(!!as.name(isoil.property),
                            breaks = pull(percentiles, var = 2),
                            include.lowest = F, labels = F, right = F),
                .groups = 'drop') %>%
      count(dataset.code_ascii_txt, label)
      
    table.reference.filled <- left_join(table.reference, n.table,
                                        by = c("dataset.code_ascii_txt", "label")) %>%
      mutate(dataset.code_ascii_txt = factor(dataset.code_ascii_txt,
                                             levels = rev(pull(dataset.codes, 1)))) %>%
      filter(!(label == 21))
    
    plot <- ggplot(table.reference.filled, aes(x = label, y = dataset.code_ascii_txt, fill = n)) +
      geom_tile(color = "gray20") +
      scale_fill_viridis(discrete = FALSE, na.value = "grey90", trans = "log10") +
      scale_x_continuous(breaks = (1:nrow(percentiles))[-nrow(percentiles)],
                         labels = pull(percentiles, 5)[-1],
                         expand = c(0.01, 0)) +
      labs(title = paste0('OSSL level 1: log2(', isoil.property, ')'),
           x = "", y = "", fill = "Count:") +
      theme_minimal() +
      theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
            legend.position = "bottom",
            plot.background = element_rect(fill = 'white', colour = "white"),
            legend.text = element_text(hjust = 1, vjust = 1, angle = 45))
    
  } else {
    
    plot.df <- plot.df %>%
      mutate(!!isoil.property := ifelse(!!as.name(isoil.property) <= 0.001, NA, !!as.name(isoil.property))) %>%
      filter(!!as.symbol(isoil.property) <= i99th)
    
    percentiles <- plot.df %>%
      summarise(quantile = scales::percent(seq(0, 1, by = 0.05)),
                !!isoil.property := quantile(!!as.name(isoil.property), seq(0, 1, by = 0.05),
                                             names = F, type = 7)) %>%
      group_by(!!as.name(isoil.property)) %>%
      summarise_all(last) %>%
      relocate(quantile, 1) %>%
      mutate(upper = get(isoil.property)) %>%
      mutate(lower = lag(upper, 1)) %>%
      mutate(upper = round(upper, 2), lower = round(lower, 2)) %>%
      mutate(label = paste0("[", lower, ", ", upper, ")"))
    
    n.table <- plot.df %>%
      filter(!is.na(!!as.symbol(isoil.property))) %>%
      group_by(dataset.code_ascii_txt) %>%
      summarise(label = cut(!!as.name(isoil.property),
                            breaks = pull(percentiles, var = 2),
                            include.lowest = F, labels = F, right = F),
                .groups = 'drop') %>%
      count(dataset.code_ascii_txt, label)
      
    table.reference.filled <- left_join(table.reference, n.table,
                                        by = c("dataset.code_ascii_txt", "label")) %>%
      mutate(dataset.code_ascii_txt = factor(dataset.code_ascii_txt,
                                             levels = rev(pull(dataset.codes, 1)))) %>%
      filter(!(label == 21))
    
    plot <- ggplot(table.reference.filled, aes(x = label, y = dataset.code_ascii_txt, fill = n)) +
      geom_tile(color = "gray20") +
      scale_fill_viridis(discrete = FALSE, na.value = "grey90", trans = "log10") +
      scale_x_continuous(breaks = (1:nrow(percentiles))[-nrow(percentiles)],
                         labels = pull(percentiles, 5)[-1],
                         expand = c(0.01, 0)) +
      labs(title = paste0('OSSL level 1: ', isoil.property),
           x = "", y = "", fill = "Count:") +
      theme_minimal() +
      theme(axis.text.x = element_text(hjust = 1, vjust = 1, angle = 45),
            legend.position = "bottom",
            plot.background = element_rect(fill = 'white', colour = "white"),
            legend.text = element_text(hjust = 1, vjust = 1, angle = 45))
    
  }
  
  ggsave(out.png, plot, width = 7, height = 5, units = "in", scale = 1)
  
}
```

## Soil site data {#sites-table}

```{r reference_soilsite, results='asis', echo=FALSE}
library("tidyverse")
library("readr")
soilsite.level0.desc <- read_csv("./tabular/ossl_level0_names_soilsite.csv")

for (i in 1:nrow(soilsite.level0.desc)) {
  
  iossl_name <- soilsite.level0.desc[[i,"ossl_name"]]
  itype <- soilsite.level0.desc[[i,"type"]]
  iexample <- soilsite.level0.desc[[i,"example"]]
  idescription <- soilsite.level0.desc[[i,"description"]]
  
  cat(paste0('\n\n\n### ', iossl_name))
  cat(paste0('\n\n', emoji::emoji("books"), ' Description: ', idescription, '.'))
  cat(paste0('\n\n', emoji::emoji("1234"), ' Type: ', itype, '.'))
  cat(paste0('\n\n', emoji::emoji("book"), ' Example: ', iexample, '.'))

}
```

## Soil laboratory (wet chemistry) data {#soillab-table}

```{r reference_soillab, results='asis', echo=FALSE}
soillab.level0.desc <- read_csv("./tabular/ossl_level0_names_soillab.csv")

for (i in 1:nrow(soillab.level0.desc)) {
  
  iossl_name <- soillab.level0.desc[[i,"ossl_name"]]
  idescription <- soillab.level0.desc[[i,"description"]]
  ianalyte <- soillab.level0.desc[[i,"analyte"]]
  iunit <- soillab.level0.desc[[i,"ossl_unit"]]
  iunit_description <- soillab.level0.desc[[i,"unit_description"]]
  itype <- soillab.level0.desc[[i,"type"]]
  iexample <- soillab.level0.desc[[i,"example"]]
  
  cat(paste0('\n\n\n### ', iossl_name))
  cat(paste0('\n\n', emoji::emoji("books"), ' Description: ', idescription, '. It can be alternatively described as `', ianalyte, '`.'))
  cat(paste0('\n\n', emoji::emoji("triangular_ruler"), ' Measurement unit: Imported into the OSSL as `', iunit, '`, i.e., ', iunit_description, '.'))
  cat(paste0('\n\n', emoji::emoji("1234"), ' Type: ', itype, '.'))
  cat(paste0('\n\n', emoji::emoji("book"), ' Example: ', iexample, '.'))
  if(file.exists(paste0("heatmap_v1.2/heatmap_L1_", iossl_name, ".png"))) {
    cat(paste0('\n\n', emoji::emoji("green_circle"), ' Availability: level 0 and level 1 (harmonized).'))
  } else if(!(iossl_name %in% c("dataset.code_ascii_txt", "id.layer_uuid_txt"))){
    cat(paste0('\n\n', emoji::emoji("yellow_circle"), ' Availability: only level 0.'))
  }
  
  # if(file.exists(paste0("hist_v1.2/hist_L0_", iossl_name, ".png"))) {
  #   cat(paste0('\n<img src="./hist_v1.2/hist_L0_',iossl_name, '.png" heigth=100% width=100%>'))
  # }
  
  if(file.exists(paste0("heatmap_v1.2/heatmap_L1_", iossl_name, ".png"))) {
    cat(paste0('\n\n<img src="./heatmap_v1.2/heatmap_L1_',iossl_name, '.png" heigth=100% width=100%>'))
  } else if(file.exists(paste0("heatmap_v1.2/heatmap_L0_", iossl_name, ".png"))) {
    cat(paste0('\n\n<img src="./heatmap_v1.2/heatmap_L0_',iossl_name, '.png" heigth=100% width=100%>'))
  }
}
```

## MIR scans {#mir-table}

```{r reference_mir, results='asis', echo=FALSE}
mir.level0.desc <- read_csv("./tabular/ossl_level0_names_mir.csv")

for (i in 1:nrow(mir.level0.desc)) {
  
  iossl_name <- mir.level0.desc[[i,"ossl_name"]]
  itype <- mir.level0.desc[[i,"type"]]
  iexample <- mir.level0.desc[[i,"example"]]
  idescription <- mir.level0.desc[[i,"description"]]
  
  cat(paste0('\n\n\n### ', iossl_name))
  cat(paste0('\n\n', emoji::emoji("books"), ' Description: ', idescription, '.'))
  cat(paste0('\n\n', emoji::emoji("1234"), ' Type: ', itype, '.'))
  cat(paste0('\n\n', emoji::emoji("book"), ' Example: ', iexample, '.'))
  
}
```

## VisNIR scans {#visnir-table}

```{r reference_visnir, results='asis', echo=FALSE}
visnir.level0.desc <- read_csv("./tabular/ossl_level0_names_visnir.csv")

for (i in 1:nrow(visnir.level0.desc)) {
  
  iossl_name <- visnir.level0.desc[[i,"ossl_name"]]
  itype <- visnir.level0.desc[[i,"type"]]
  iexample <- visnir.level0.desc[[i,"example"]]
  idescription <- visnir.level0.desc[[i,"description"]]
  
  cat(paste0('\n\n\n### ', iossl_name))
  cat(paste0('\n\n', emoji::emoji("books"), ' Description: ', idescription, '.'))
  cat(paste0('\n\n', emoji::emoji("1234"), ' Type: ', itype, '.'))
  cat(paste0('\n\n', emoji::emoji("book"), ' Example: ', iexample, '.'))
  
}
```
